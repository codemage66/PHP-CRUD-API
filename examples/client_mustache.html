<html>
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.1/mustache.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.6/zepto.min.js"></script>
<script src="../lib/php_crud_api_transform.js"></script>
<script id="PostList_Item" type="text/mustache">
<ul>
	{{#posts}}
		<li>
			{{id}}, {{content}}
			<a href="javascript:void(0)" key="{{id}}">del</a>
		</li>
	{{/posts}}
	<li>
		<form>
			<input name="content"/>
		</form>
	</li>
</ul>
</script>
<script>
function PostList(element, template) {
	var self = this;
	var url = '../api.php/posts';
	self.delete = function() {
		var id = $(this).attr('key');
		$.ajax({url:url+'/'+id, type: 'DELETE', success:self.update});
	};
	self.submit = function(e) {
		e.preventDefault();
		var content = $(this).find('input[name="content"]').val();
		$.post(url, {user_id:1,category_id:1,content:content}, self.update);
	};
	self.render = function(data) {
		$(element).html(Mustache.to_html($(template).html(),php_crud_api_transform(data)));
	};
	self.update = function() {
		$.get(url, self.render);
	};
	self.post = function() {
		$.post(url, {user_id:1,category_id:1,content:"from mustache"}, self.update);
	};
	$(element).on('submit','form',self.submit);
	$(element).on('click','a',self.delete)
	self.post();
};
$(function(){ new PostList('#myApplication','#PostList_Item'); });
</script>
</head>
<body>
<div id="myApplication">Loading...</div>
</body>
</html>
