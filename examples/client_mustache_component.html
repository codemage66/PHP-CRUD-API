<html>
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.1/mustache.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.6/zepto.min.js"></script>
<script src="../lib/php_crud_api_transform.js"></script>
<script>
$(function(){
	var self = this;
	var components = {};

	function handleComponent(){
		var name = $(this).attr('component');
		var template = '';

		if (components[name]) return;
		components[name] = true;
		
		$.ajax({dataType:'text', url: name+'.css',success:function(data){
			$('<style>').appendTo('body').text(data);
		}});
		$.ajax({dataType:'text', url: name+'.html',success:function(data){
			template = data;
			$.ajax({dataType:'text', url: name+'.js',success:function(data){
				var fn = eval(data);
				$(['div.component[component="'+name+'"]']).each(function(){
					fn($(this),template);
				});
			}});
		}});		
	}

	$('div.component').each(handleComponent);
});
</script>
</head>
<body>
<div class="component" component="post-list">Loading...</div>
</body>
</html>
